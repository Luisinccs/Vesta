<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Vesta.UI.Views.DashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:Vesta.Core.Models"
    xmlns:vm="clr-namespace:Vesta.UI.ViewModels"
    Title="Dashboard"
    BackgroundColor="#1a1a1a">

    <ContentPage.Resources>
        <ResourceDictionary>
            <!--  Paleta de Colores  -->
            <Color x:Key="BackgroundDark">#1a1a1a</Color>
            <Color x:Key="TextLight">#e9ecef</Color>
            <Color x:Key="AccentBlue">#457b9d</Color>
            <Color x:Key="AlertRed">#e63946</Color>
            <Color x:Key="WarnAmber">#ffb703</Color>
            <Color x:Key="SuccessGreen">#2a9d8f</Color>

            <!--  Estilo para Hallazgos  -->
            <Style x:Key="FindingCardStyle" TargetType="Border">
                <Setter Property="StrokeShape" Value="RoundRectangle 8" />
                <Setter Property="Stroke" Value="#333333" />
                <Setter Property="BackgroundColor" Value="#252525" />
                <Setter Property="Padding" Value="15" />
                <Setter Property="Margin" Value="0,0,0,10" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="20" RowDefinitions="Auto, *, Auto">

        <!--  HEADER  -->
        <HorizontalStackLayout
            Grid.Row="0"
            Margin="0,10,0,20"
            HorizontalOptions="Center"
            Spacing="10"
            VerticalOptions="Center">
            <Label
                FontSize="24"
                Text="ðŸ”’"
                VerticalOptions="Center" />
            <Label
                CharacterSpacing="2"
                FontAttributes="Bold"
                FontSize="28"
                Text="VESTA"
                TextColor="{StaticResource TextLight}"
                VerticalOptions="Center" />
        </HorizontalStackLayout>

        <!--  CONTENIDO PRINCIPAL  -->
        <ScrollView Grid.Row="1" VerticalScrollBarVisibility="Never">
            <VerticalStackLayout Spacing="25">

                <!--  INDICADOR DE RIESGO CIRCULAR  -->
                <Grid
                    HeightRequest="180"
                    HorizontalOptions="Center"
                    WidthRequest="180">
                    <Ellipse
                        HeightRequest="170"
                        Stroke="#333333"
                        StrokeThickness="12"
                        WidthRequest="170" />
                    <Border
                        x:Name="RiskIndicator"
                        BackgroundColor="Transparent"
                        HeightRequest="170"
                        Stroke="{StaticResource AccentBlue}"
                        StrokeShape="RoundRectangle 85"
                        StrokeThickness="12"
                        WidthRequest="170">
                        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Text="RIESGO"
                                TextColor="#888888" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="22"
                                HorizontalOptions="Center"
                                Text="{Binding CurrentReport.RiskLevel}"
                                TextColor="{StaticResource TextLight}">
                                <Label.Triggers>
                                    <DataTrigger
                                        Binding="{Binding CurrentReport.RiskLevel}"
                                        TargetType="Label"
                                        Value="Red">
                                        <Setter Property="TextColor" Value="{StaticResource AlertRed}" />
                                    </DataTrigger>
                                    <DataTrigger
                                        Binding="{Binding CurrentReport.RiskLevel}"
                                        TargetType="Label"
                                        Value="Amber">
                                        <Setter Property="TextColor" Value="{StaticResource WarnAmber}" />
                                    </DataTrigger>
                                    <DataTrigger
                                        Binding="{Binding CurrentReport.RiskLevel}"
                                        TargetType="Label"
                                        Value="Green">
                                        <Setter Property="TextColor" Value="{StaticResource SuccessGreen}" />
                                    </DataTrigger>
                                </Label.Triggers>
                            </Label>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <!--  RESUMEN EJECUTIVO  -->
                <VerticalStackLayout Spacing="5">
                    <!--  Simplificado para el ejemplo  -->
                    <Label
                        FontAttributes="Bold"
                        FontSize="18"
                        Text="Resumen de AuditorÃ­a"
                        TextColor="{StaticResource TextLight}" />
                    <Label
                        FontSize="14"
                        LineBreakMode="WordWrap"
                        Text="{Binding CurrentReport.Summary}"
                        TextColor="#bbbbbb" />
                </VerticalStackLayout>

                <!--  LISTA DE HALLAZGOS  -->
                <Label
                    FontAttributes="Bold"
                    FontSize="18"
                    Text="Hallazgos Detectados"
                    TextColor="{StaticResource TextLight}" />
                <CollectionView ItemsSource="{Binding CurrentReport.Findings}" SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Finding">
                            <Border Style="{StaticResource FindingCardStyle}">
                                <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto, Auto">
                                    <Label
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        Text="{Binding ClauseTitle}"
                                        TextColor="{StaticResource TextLight}" />
                                    <Border
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Padding="8,2"
                                        BackgroundColor="#1a1a1a"
                                        StrokeShape="RoundRectangle 4">
                                        <Label
                                            FontSize="10"
                                            Text="{Binding Severity}"
                                            TextColor="{StaticResource TextLight}" />
                                    </Border>
                                    <Label
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Margin="0,5,0,0"
                                        FontSize="13"
                                        Text="{Binding RiskDescription}"
                                        TextColor="#999999" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <!--  ACCIÃ“N Y ESTADO  -->
        <VerticalStackLayout
            Grid.Row="2"
            Spacing="15"
            VerticalOptions="End">

            <!--  MENSAJE DE ESTADO  -->
            <Label
                FontSize="14"
                HorizontalOptions="Center"
                IsVisible="{Binding IsBusy}"
                Text="{Binding StatusMessage}"
                TextColor="{StaticResource AccentBlue}" />

            <!--  BOTÃ“N DE ACCIÃ“N  -->
            <Button
                BackgroundColor="{StaticResource AccentBlue}"
                Command="{Binding AnalyzeDocumentCommand}"
                CornerRadius="8"
                FontAttributes="Bold"
                HeightRequest="55"
                Text="ANALIZAR CONTRATO"
                TextColor="{StaticResource TextLight}" />
        </VerticalStackLayout>

        <!--  OVERLAY DE CARGA  -->
        <Grid
            Grid.RowSpan="3"
            BackgroundColor="#AA000000"
            IsVisible="{Binding IsBusy}">
            <ActivityIndicator
                HeightRequest="50"
                HorizontalOptions="Center"
                IsRunning="{Binding IsBusy}"
                VerticalOptions="Center"
                Color="{StaticResource AccentBlue}" />
        </Grid>

    </Grid>
</ContentPage>
